<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">

<dom-module id="my-login">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      span,
      input {
        @apply(--paper-font-body2);
      }
    </style>

	<div><paper-input id="username-input" value="{{username::input}}" label="Username"></div>
	<div><paper-input id="password-input" value="{{password::input}}" label="Password" type="password"></div>
	<div><paper-button id="login-button" on-tap="doLogin">Login</paper-button>
	<paper-spinner id="spinner"></paper-spinner></div>
	<iron-ajax id="ajax"
		       url="https://matom.at/api/{{username}}/balance"
		       headers$='{"pass":"[[password]]"}'
		       on-response="doResponse"
		       on-error="doError"
			   handle-as="json"></iron-ajax>
		   <paper-toast id="toastFail" text="Login fehlgeschlagen"></paper-toast>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'my-login',

		doLogin: function(e){
			let a=this.$.ajax;
			this.$.spinner.active=true;
			a.generateRequest();
		},
		doResponse: function(e){
			this.$.spinner.active=false;
			this.fire('login',{username:this.username,password:this.password});
		},
		doError: function(e){
			this.$.spinner.active=false;
			this.$.toastFail.open();
		},

        properties: {
          username: {
            type: String,
            value: '',
            notify: true,
          },
          password: {
            type: String,
            value: '',
            notify: true,
          },
        }
      });
    })();
  </script>
</dom-module>
